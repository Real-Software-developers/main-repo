<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Responsive Bootstrap4 Shop Template, Created by Imran Hossain from https://imransdesign.com/">

	<!-- title -->
	<title>Contact</title>

	<!-- favicon -->
	<link rel="shortcut icon" type="image/png" href="assets/img/favicon.png">
	<!-- google font -->
	<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Poppins:400,700&display=swap" rel="stylesheet">
	<!-- fontawesome -->
	<link rel="stylesheet" href="assets/css/all.min.css">
	<!-- bootstrap -->
	<link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
	<!-- owl carousel -->
	<link rel="stylesheet" href="assets/css/owl.carousel.css">
	<!-- magnific popup -->
	<link rel="stylesheet" href="assets/css/magnific-popup.css">
	<!-- animate css -->
	<link rel="stylesheet" href="assets/css/animate.css">
	<!-- mean menu css -->
	<link rel="stylesheet" href="assets/css/meanmenu.min.css">
	<!-- main style -->
	<link rel="stylesheet" href="assets/css/main.css">
	<!-- responsive -->
	<link rel="stylesheet" href="assets/css/responsive.css">

</head>
<body>
	
	<!--PreLoader-->
    <div class="loader">
        <div class="loader-inner">
            <div class="circle"></div>
        </div>
    </div>
    <!--PreLoader Ends-->
	

	<div class="top-header-area" id="sticker">
		<div class="container">
		  <div class="row">
			<div class="col-lg-12 col-sm-12 text-center">
			  <div class="main-menu-wrap">
				<!-- logo -->
				<div class="site-logo">
				  <a href="index.html">
					<img src="master.jpg"logo for site" width="50px" height="50px" style="border-radius: 15px;">
				  </a>
				</div>
				<!-- logo -->
	
				<!-- menu start -->
				<nav class="main-menu">
				  <ul>
					<li class="current-list-item"><a href="#">Home</a>
					  
					</li>
					<li><a href="/window_shop/">Window shop</a></li>
	
									
					
					<li><a href="/trackit/">TrackYourOrder</a>
					  
					</li>
					<li><a href="/contact/">Contact</a></li>
	
	
					<li><a href="">SignIn</a>
					  <ul class="sub-menu">
						<li><a href="/shopper/">Shopper?</a></li>
						<li><a href="/shopowner/">ShopOwner</a></li>
						<li><a href="/admin/">Admin</a></li>
						<li><a href="#">Meet the team</a></li>
					  </ul>
					</li>
									
	
	
					<li>
					  <div class="header-icons">
						<a class="shopping-cart" href="cart.html"><i class="fas fa-shopping-cart"></i></a>
						<a class="mobile-hide search-bar-icon" href="#"><i class="fas fa-search"></i></a>
					  </div>
					</li>
				  </ul>
				</nav>
				<a class="mobile-show search-bar-icon" href="#"><i class="fas fa-search"></i></a>
				<div class="mobile-menu"></div>
				<!-- menu end -->
			  </div>
			</div>
		  </div>
		</div>
	  </div>
	
	<!-- breadcrumb-section -->
	<div class="breadcrumb-section breadcrumb-bg">
		<div class="container">
			<div class="row">
				<div class="col-lg-8 offset-lg-2 text-center">
					<div class="breadcrumb-text">
						<p>sell stuff online.</p>
						<h1>Register your shop</h1>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end breadcrumb section -->
<!-- product section -->


        <!-- contact form -->
	<div class="contact-from-section mt-150 mb-150">
		<div class="container">
			<div class="row">
				<div class="col-lg-8 mb-5 mb-lg-0">
					<div class="form-title">
						<h2>Have admin confirm your shop in minutes!</h2>
						<p>Enter the following details about your shop and these information will be sent to the admin to verify legitibility of your shop and if your shop is legit,you will receive an email letting you know that your shop has been approved!</p>
					</div>
				 	<div id="form_status"></div>
					<div class="contact-form">
						<form type="POST" id="shopOwnerForm">
							<p>
								<input type="text" placeholder="Name" name="name" id="name">
                                <input type="text" placeholder="ShopName" name="Shopname" id="shopname">
							</p>
							<p>
								<input type="tel" placeholder="Phone" name="phone" id="phone">
								<input type="email" placeholder="Email" name="email" id="email">
							</p>

                            <p>
                                <input type="text" placeholder="Location of shop" name="Location" id="Location">
								<input type="password" placeholder="password" id="password">
                            </p>

							<p>
								<textarea name="message" id="message" cols="30" rows="10" placeholder="small shop description"></textarea>
							</p>
							
							<p><input type="submit" value="Submit"></p>
						</form>
					</div>
				</div>
				<div class="col-lg-4">
					<div class="contact-form-wrap">
						<div class="contact-form-box">
							<h4><i class="far fa-clock"></i> Send email</h4>
							<p>Admin will get back to you in few minutes!</p>
						</div>
						
						<div class="contact-form-box">
							<h4><i class="fas fa-address-book"></i> Contact</h4>
							<p>Phone: +27 71 221 8169 <br> Email: aspaza811@gmail.com</p>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end contact form -->
	<div class="contact-form">
		<form type="POST" id="Login">
			<p>
				<input type="email" placeholder="Email" name="email" id="login-email">
				<input type="password" placeholder="Password" name="password" id="login-password">
			</p>
			<p><input type="submit" value="Login"></p>
		</form>
	</div>
	
</div>

<


<script type="module">
	import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";
	import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-analytics.js";
	import { getDatabase, ref, push, set,get } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-database.js";
	import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendEmailVerification } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-auth.js";

	// Your Firebase configuration
	const firebaseConfig = {
	apiKey: "AIzaSyCDvwIj5sxqJE-yIrkQhBtPLAWDlKxY-zU",
	authDomain: "entiresystem-7ea4f.firebaseapp.com",
	databaseURL: "https://entiresystem-7ea4f-default-rtdb.asia-southeast1.firebasedatabase.app",
	projectId: "entiresystem-7ea4f",
	storageBucket: "entiresystem-7ea4f.appspot.com",
	messagingSenderId: "25619596774",
	appId: "1:25619596774:web:e296b99271610195690227",
	measurementId: "G-LXVGY3MW22"
	};

	
	// Initialize Firebase app
	const app = initializeApp(firebaseConfig);
	const analytics = getAnalytics(app);
	const database = getDatabase(app);
	const auth = getAuth(app); // Get the auth object
	


	emailjs.init("_9cCImG_eM_ixRlo6");


	// Function to submit the form and write data to Firebase Realtime Database and Firestore
	document.getElementById('shopOwnerForm').addEventListener('submit', async function(e) {
		e.preventDefault();

		// Get form values
		// Get form values
		const name = document.getElementById('name').value;
		const shopName = document.getElementById('shopname').value;
		const phone = document.getElementById('phone').value;
		const email = document.getElementById('email').value;
		const password = document.getElementById('password').value;
		const location = document.getElementById('Location').value;
		const description = document.getElementById('message').value;
		localStorage.setItem('username',name);

		

		// Reference to the Firebase Realtime Database
		const databaseRef = ref(database, 'shopOwners');

		// Push data to Firebase Realtime Database
		const newShopOwnerRef = push(databaseRef);
		set(newShopOwnerRef, {
			name: name,
			shopName: shopName,
			phone: phone,
			email: email,
			location: location,
			description: description
		}).then(() => {
			console.log("Shop owner data added to Firebase Realtime Database");
			// Reset form
			document.getElementById('shopOwnerForm').reset();
		}).catch((error) => {
			console.error("Error adding shop owner data to Firebase Realtime Database:", error);
		});

		try {
        // Send email so that admin can verify a shop  using EmailJS
        await emailjs.send("service_a5itk56", "template_89469et", {
			ownerName: name,
            userEmail: email,
            shopName: shopName,
            location: location,
            description: description

			
        });
        console.log('Email to admin sent successfully!');
    } catch (error) {
        console.error("Error sending email to admin:", error);
    }


		// Reference to the "shops" collection
		const shopsRef = ref(database, 'shops');

		// Push data to Firebase Realtime Database for "shops" collection
		const newShopRef = push(shopsRef);
		set(newShopRef, {
			shopName: shopName,
			description: description,
			location: location
		}).then(() => {
			console.log("Shop details added to Firebase Realtime Database for 'shops' collection");
			// Reset form
			document.getElementById('shopOwnerForm').reset();
		}).catch((error) => {
			console.error("Error adding shop details to Firebase Realtime Database for 'shops' collection:", error);
		});

  try {
			// Create user with email and password
			const userCredential = await createUserWithEmailAndPassword(auth, email, password);
			const user = userCredential.user;
  
			// Send email verification
			await sendEmailVerification(auth.currentUser);

			// Reference to the Firebase Realtime Database
			const databaseRef = ref(database, 'owners');

			// Push data to Firebase Realtime Database for shoppers collection
			const newShopperRef = push(databaseRef);
			set(newShopperRef, {
				userId: user.uid, // Add user ID to shopper data
				name: name,
				email: email,
				shopName: shopName,
				message: message
			}).then(() => {
				console.log("Shopper data added to Firebase Realtime Database");
				// Store email and username in local storage
				localStorage.setItem('userEmail', email);
				localStorage.setItem('username', name);
				console.log("User data stored in local storage");
				// Reset form
				document.getElementById('shopOwnerForm').reset();
			}).catch((error) => {
				console.error("Error adding shopper data to Firebase Realtime Database:", error);
			});
		} catch (error) {
			console.error("Error creating user:", error);
			// Check if the error is related to an invalid email
			if (error.code === "auth/invalid-email") {
				// Display an alert message indicating that the email is not valid
				alert("Invalid email. Please provide a valid email address.");
			}
		}

	});

	// Function to handle user login with email and password
	document.getElementById('Login').addEventListener('submit', async function(e) {
		e.preventDefault();

		// Get email and password from the form
		const email = document.getElementById('login-email').value;
		const password = document.getElementById('login-password').value;

		try {
			// Sign in user with email and password
			const userCredential = await signInWithEmailAndPassword(auth, email, password);
			const user = userCredential.user;

			// Check if the user's email is verified
			if (user.emailVerified) {
				localStorage.setItem('userEmail', email);
				// User is signed in and email is verified, allow access to protected pages
				// Redirect to the desired page
				window.location.href = '/myshop/';
			} else {
				// User's email is not verified, display an alert
				alert("Please verify your email address before logging in.");
			}
		} catch (error) {
			console.error("Error signing in:", error);
			// Display error message to the user
			alert("An error occurred during login. Please check your email and password and try again.");
		}
	});

</script>
    <!-- Include your JavaScript file -->
	
	<script src="assets/js/jquery-1.11.3.min.js"></script>
	<!-- bootstrap -->
	<script src="assets/bootstrap/js/bootstrap.min.js"></script>
	<!-- count down -->
	<script src="assets/js/jquery.countdown.js"></script>
	<!-- isotope -->
	<script src="assets/js/jquery.isotope-3.0.6.min.js"></script>
	<!-- waypoints -->
	<script src="assets/js/waypoints.js"></script>
	<!-- owl carousel -->
	<script src="assets/js/owl.carousel.min.js"></script>
	<!-- magnific popup -->
	<script src="assets/js/jquery.magnific-popup.min.js"></script>
	<!-- mean menu -->
	<script src="assets/js/jquery.meanmenu.min.js"></script>
	<!-- sticker js -->
	<script src="assets/js/sticker.js"></script>
	<!-- form validation js -->
	<script src="assets/js/form-validate.js"></script>
	<!-- main js -->
	<script src="assets/js/main.js"></script>

	<!-- Include EmailJS library -->
    <script src="https://cdn.emailjs.com/dist/email.min.js"></script>
	

	
</body>
</html>