<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Responsive Bootstrap4 Shop Template, Created by Imran Hossain from https://imransdesign.com/">

	<!-- title -->
	<title>Cart</title>

	<!-- favicon -->
	<link rel="shortcut icon" type="image/png" href="assets/img/favicon.png">
	<!-- google font -->
	<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Poppins:400,700&display=swap" rel="stylesheet">
	<!-- fontawesome -->
	<link rel="stylesheet" href="assets/css/all.min.css">
	<!-- bootstrap -->
	<link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
	<!-- owl carousel -->
	<link rel="stylesheet" href="assets/css/owl.carousel.css">
	<!-- magnific popup -->
	<link rel="stylesheet" href="assets/css/magnific-popup.css">
	<!-- animate css -->
	<link rel="stylesheet" href="assets/css/animate.css">
	<!-- mean menu css -->
	<link rel="stylesheet" href="assets/css/meanmenu.min.css">
	<!-- main style -->
	<link rel="stylesheet" href="assets/css/main.css">
	<!-- responsive -->
	<link rel="stylesheet" href="assets/css/responsive.css">

</head>
<body>
	
	<!--PreLoader-->
    <div class="loader">
        <div class="loader-inner">
            <div class="circle"></div>
        </div>
    </div>
    <!--PreLoader Ends-->
	
	<!-- header -->
	
	<!-- search area -->
	
	<!-- end search arewa -->
	
	<!-- breadcrumb-section -->
	<div class="breadcrumb-section breadcrumb-bg">
		<div class="container">
			<div class="row">
				<div class="col-lg-8 offset-lg-2 text-center">
					<div class="breadcrumb-text">
						<p>Fresh and Organic</p>
						<h1>Cart at checkout!</h1>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end breadcrumb section -->

	<!-- cart -->
	<div class="cart-section mt-150 mb-150">
		<div class="container" id="container">
			<div class="row" id="row">
				<div class="col-lg-8 col-md-12">
					<div class="cart-table-wrap">
						<table class="cart-table">
							<thead class="cart-table-head">
								<tr class="table-head-row">
									<th class="product-remove"></th>
									<th class="product-image">Product Image</th>
									<th class="product-name">Name</th>
									<th class="product-price">Price</th>
									
								</tr>
							</thead>
							<tbody>
								<tr class="table-body-row">
									<td class="product-remove"><a href="#"><i class="far fa-window-close"></i></a></td>
									<td class="product-image"><img src="assets/img/products/product-img-1.jpg" alt=""></td>
									<td class="product-name">Strawberry</td>
									<td class="product-price">price</td>
									
								</tr>
								<tr class="table-body-row">
									<td class="product-remove"><a href="#"><i class="far fa-window-close"></i></a></td>
									<td class="product-image"><img src="assets/img/products/product-img-2.jpg" alt=""></td>
									<td class="product-name">Berry</td>
									<td class="product-price">price</td>
									
								</tr>
								<tr class="table-body-row">
									<td class="product-remove"><a href="#"><i class="far fa-window-close"></i></a></td>
									<td class="product-image"><img src="assets/img/products/product-img-3.jpg" alt=""></td>
									<td class="product-name">Lemon</td>
									<td class="product-price">R0.00</td>
								
								</tr>
							</tbody>
						</table>
					</div>
				</div>

				<div class="col-lg-4">
					<div class="total-section">
						<table class="total-table" id="statistics">
							<thead class="total-table-head">
								<tr class="table-total-row">
									<th>Total</th>
									<th>Price</th>
								</tr>
							</thead>
							<tbody>
								<tr class="total-data">
									<td><strong>Subtotal: </strong></td>
									<td>price-of-selected-product</td>
								</tr>
								<tr class="total-data">
									<td ><strong>Shipping: </strong></td>
									<td id="Shipping">price-of-selected-product</td>
								</tr>
								<tr class="total-data">
									<td><strong>Total: </strong></td>
									<td id="total.">price-of-selected-product</td>
								</tr>
							</tbody>
						</table>
						<div class="cart-buttons">
							<a href="#" class="boxed-btn">Get Back Shopping!</a>
							<a href="#" class="boxed-btn black" id="place-order">Place Order!</a>
						</div>
					</div>

					
				</div>
			</div>
		</div>
	</div>
	<!-- end cart -->

	

	
	<!-- footer -->
	<div class="footer-area">
		<div class="container">
			<div class="row">
				<div class="col-lg-3 col-md-6">
					<div class="footer-box about-widget">
						<h2 class="widget-title">About us</h2>
						<p>Ut enim ad minim veniam perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae.</p>
					</div>
				</div>
				<div class="col-lg-3 col-md-6">
					<div class="footer-box get-in-touch">
						<h2 class="widget-title">Get in Touch</h2>
						<ul>
							<li>address of shop.</li>
							<li>they're email</li>
							<li>the're phone number</li>
						</ul>
					</div>
				</div>
				
				
			</div>
		</div>
	</div>
	
	<!-- copyright -->
	<div class="copyright">
		<div class="container">
			<div class="row">
				<div class="col-lg-6 col-md-12">
					<p>Copyrights &copy; Reserved!
					</p>
				</div>
				<div class="col-lg-6 text-right col-md-12">
					<div class="social-icons">
						<ul>
							<li><a href="#" target="_blank"><i class="fab fa-facebook-f"></i></a></li>
							<li><a href="#" target="_blank"><i class="fab fa-twitter"></i></a></li>
							<li><a href="#" target="_blank"><i class="fab fa-instagram"></i></a></li>
							<li><a href="#" target="_blank"><i class="fab fa-linkedin"></i></a></li>
							<li><a href="#" target="_blank"><i class="fab fa-dribbble"></i></a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end copyright -->
	
	
	<!-- jquery -->
	<script src="assets/js/jquery-1.11.3.min.js"></script>
	<!-- bootstrap -->
	<script src="assets/bootstrap/js/bootstrap.min.js"></script>
	<!-- count down -->
	<script src="assets/js/jquery.countdown.js"></script>
	<!-- isotope -->
	<script src="assets/js/jquery.isotope-3.0.6.min.js"></script>
	<!-- waypoints -->
	<script src="assets/js/waypoints.js"></script>
	<!-- owl carousel -->
	<script src="assets/js/owl.carousel.min.js"></script>
	<!-- magnific popup -->
	<script src="assets/js/jquery.magnific-popup.min.js"></script>
	<!-- mean menu -->
	<script src="assets/js/jquery.meanmenu.min.js"></script>
	<!-- sticker js -->
	<script src="assets/js/sticker.js"></script>
	<!-- main js -->
	<script src="assets/js/main.js"></script>
	<script>
		// Retrieve the JSON string from local storage
//const cartItemsJSON = localStorage.getItem("cartItems");

// Parse the JSON string back into an array
		//const cartItems = JSON.parse(cartItemsJSON);

		document.addEventListener("DOMContentLoaded", function() {
    // Retrieve cart items from local storage
    const cartItemsJSON = localStorage.getItem("cartItems");
    const cartItems = JSON.parse(cartItemsJSON);

    // Get the tbody element of the cart table
    const tbody = document.querySelector(".cart-table tbody");

    // Get the total price cell
    const totalPriceCell = document.querySelector(".total-data td:last-child");
	const ShippingPriceCell = document.getElementById("Shipping");
	const grandtotal = document.getElementById("total.");


	ShippingPriceCell.innerHTML="R30.00";
    // Clear previous content in the tbody
    tbody.innerHTML = "";

    // Initialize total price
    let totalPrice = 0;

    // Check if cartItems is not null and not undefined, and is an array
    if (Array.isArray(cartItems)) {
        // Iterate over the cart items and update the table
        cartItems.forEach(item => {
            if (item && typeof item === 'object') {
                // Create a new row for the cart item
                const newRow = document.createElement("tr");
                newRow.classList.add("table-body-row");

                // Create table cells for each property of the cart item
                const removeCell = document.createElement("td");
                removeCell.classList.add("product-remove");
                removeCell.innerHTML = '<a href="#"><i class="far fa-window-close"></i></a>';
                newRow.appendChild(removeCell);

                const imageCell = document.createElement("td");
                imageCell.classList.add("product-image");
                imageCell.innerHTML = '<img src="assets/img/products/product-img-1.jpg" alt="">';
                newRow.appendChild(imageCell);

                const nameCell = document.createElement("td");
                nameCell.classList.add("product-name");
                nameCell.textContent = item.productName; // Accessing productName property
                newRow.appendChild(nameCell);

                const priceCell = document.createElement("td");
                priceCell.classList.add("product-price");
                priceCell.textContent = item.productPrice; // Accessing productPrice property
                newRow.appendChild(priceCell);

                // const quantityCell = document.createElement("td");
                // quantityCell.classList.add("product-quantity");
                // quantityCell.innerHTML = '<input type="number" placeholder="0">';
                // newRow.appendChild(quantityCell);

                // const totalCell = document.createElement("td");
                // totalCell.classList.add("product-total");
                // totalCell.textContent = 'x'; // Placeholder value
                // newRow.appendChild(totalCell);

                // Add item price to total price
                totalPrice += parseFloat(item.productPrice);

                // Append the new row to the tbody
                tbody.appendChild(newRow);
            } else {
                console.error("Invalid cart item format:", item);
            }
        });
    } else {
        console.error("Invalid cart items format:", cartItems);
    }

    // Update the total price cell
    totalPriceCell.textContent = ` R ${totalPrice.toFixed(2)}`; // Assuming 2 decimal places for currency
	grandtotal.innerHTML=`R ${(30+parseInt(totalPrice.toFixed(2))).toFixed(2)}`;
});
	</script>

<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";
    import { getDatabase, ref, set, push } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-database.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyCDvwIj5sxqJE-yIrkQhBtPLAWDlKxY-zU",
        authDomain: "entiresystem-7ea4f.firebaseapp.com",
        databaseURL: "https://entiresystem-7ea4f-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "entiresystem-7ea4f",
        storageBucket: "entiresystem-7ea4f.appspot.com",
        messagingSenderId: "25619596774",
        appId: "1:25619596774:web:e296b99271610195690227",
        measurementId: "G-LXVGY3MW22"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    // Function to place order
    function placeOrder() {
        // Retrieve cart items and user details from local storage
        const username = localStorage.getItem("username");
        const userEmail = localStorage.getItem("userEmail");
        const shopName = localStorage.getItem("Shopname");
        const cartItemsJSON = localStorage.getItem("cartItems");
        const cartItems = JSON.parse(cartItemsJSON);

        if (username && userEmail && Array.isArray(cartItems)) {
            // Create a new order object
            const newOrder = {
                username: username,
                email: userEmail,
                shopName: shopName,
                items: cartItems,
                timestamp: Date.now()
            };

            // Get a reference to the orders collection
            const ordersRef = ref(database, 'orders');

            // Push the new order to the orders collection
            const newOrderRef = push(ordersRef);
            set(newOrderRef, newOrder)
                .then(() => {
                    console.log("Order placed successfully!");
                    // Optionally clear the cart and local storage
                    localStorage.removeItem("cartItems");
                    alert("Order placed successfully!");
                })
                .catch((error) => {
                    console.error("Error placing order:", error);
                });
        } else {
            console.error("Invalid order data");
        }
    }

    // Add event listener to the "Place Order" button
    document.getElementById("place-order").addEventListener("click", placeOrder);
</script>

</body>
</html>