<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Responsive Bootstrap4 Shop Template, Created by Imran Hossain from https://imransdesign.com/">

	<!-- title -->
	<title>Cart</title>

	<!-- favicon -->
	<link rel="shortcut icon" type="image/png" href="assets/img/favicon.png">
	<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

	<!-- google font -->
	<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Poppins:400,700&display=swap" rel="stylesheet">
	<!-- fontawesome -->
	<link rel="stylesheet" href="assets/css/all.min.css">
	<!-- bootstrap -->
	<link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
	<!-- owl carousel -->
	<link rel="stylesheet" href="assets/css/owl.carousel.css">
	<!-- magnific popup -->
	<link rel="stylesheet" href="assets/css/magnific-popup.css">
	<!-- animate css -->
	<link rel="stylesheet" href="assets/css/animate.css">
	<!-- mean menu css -->
	<link rel="stylesheet" href="assets/css/meanmenu.min.css">
	<!-- main style -->
	<link rel="stylesheet" href="assets/css/main.css">
	<!-- responsive -->
	<link rel="stylesheet" href="assets/css/responsive.css">

</head>
<body>
	
	<!--PreLoader-->
    <div class="loader">
        <div class="loader-inner">
            <div class="circle"></div>
        </div>
    </div>
    <!--PreLoader Ends-->
	
	<!-- header -->
	
	<!-- search area -->
	
	<!-- end search arewa -->
	
	<!-- breadcrumb-section -->
	<div class="breadcrumb-section breadcrumb-bg">
		<div class="container">
			<div class="row">
				<div class="col-lg-8 offset-lg-2 text-center">
					<div class="breadcrumb-text">
						<p>Fresh and Organic</p>
						<h1>Cart at checkout!</h1>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end breadcrumb section -->

	<div class="container mt-3">
		<div id="alert-container"></div>
	</div>
	

	<div class="cart-section mt-150 mb-150">
		<div class="container">
			<div class="row">
				<!-- Cart Items -->
				<div class="col-lg-8 col-md-12">
					<div class="cart-table-wrap">
						<table class="cart-table">
							<thead class="cart-table-head">
								<tr class="table-head-row">
									<th class="product-remove"></th>
									<th class="product-image">Product Image</th>
									<th class="product-name">Name</th>
									<th class="product-price">Price</th>
								</tr>
							</thead>
							<tbody>
								<td class="product-remove"><button class="remove-btn"><i class="far fa-window-close"></i></button></td>

								<!-- Cart items will be dynamically inserted here -->
							</tbody>
						</table>
					</div>
				</div>
	
				<!-- Order Summary -->
				<div class="col-lg-4 col-md-12">
					<div class="total-section">
						<table class="total-table" id="statistics">
							<thead class="total-table-head">
								<tr class="table-total-row">
									<th>Total</th>
									<th>Price</th>
								</tr>
							</thead>
							<tbody>
								<tr class="total-data">
									<td><strong>Subtotal: </strong></td>
									<td class="total-price">price-of-selected-product</td>
								</tr>
								<tr class="total-data">
									<td><strong>Shipping: </strong></td>
									<td id="Shipping">price-of-selected-product</td>
								</tr>
								<tr class="total-data">
									<td><strong>Total: </strong></td>
									<td id="total.">price-of-selected-product</td>
								</tr>
							</tbody>
						</table>
						<div class="cart-buttons">
							<a href="/trackit/" class="boxed-btn">Track your order</a>
							<a href="#" class="boxed-btn black" id="place-order">Place Order!</a>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
<style>
	.cart-section {
    margin-top: 150px;
    margin-bottom: 150px;
}

.cart-table-wrap {
    overflow-x: auto;
}

.total-section {
    background-color: #f9f9f9;
    padding: 20px;
    border: 1px solid #ddd;
    border-radius: 5px;
}

.total-table {
    width: 100%;
    margin-bottom: 20px;
}
.fa-window-close{
	border-radius: 5px;
	width: 20px;
	height: 20px;
	color: red;
}

.remove-btn{
	border-radius: 5px;
	background-color: azure;
}

@media (max-width: 768px) {
    .cart-buttons .boxed-btn {
        margin-bottom: 15px;
    }
}

</style>	
	

	
	<!-- footer -->
	<div class="footer-area">
		<div class="container">
			<div class="row">
				<div class="col-lg-3 col-md-6">
					<div class="footer-box about-widget">
						<h2 class="widget-title">About us</h2>
						<p>Ut enim ad minim veniam perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae.</p>
					</div>
				</div>
				<div class="col-lg-3 col-md-6">
					<div class="footer-box get-in-touch">
						<h2 class="widget-title">Get in Touch</h2>
						<ul>
							<li>address of shop.</li>
							<li>they're email</li>
							<li>the're phone number</li>
						</ul>
					</div>
				</div>
				
				
			</div>
		</div>
	</div>
	
	<!-- copyright -->
	<div class="copyright">
		<div class="container">
			<div class="row">
				<div class="col-lg-6 col-md-12">
					<p>Copyrights &copy; Reserved!
					</p>
				</div>
				<div class="col-lg-6 text-right col-md-12">
					<div class="social-icons">
						<ul>
							<li><a href="#" target="_blank"><i class="fab fa-facebook-f"></i></a></li>
							<li><a href="#" target="_blank"><i class="fab fa-twitter"></i></a></li>
							<li><a href="#" target="_blank"><i class="fab fa-instagram"></i></a></li>
							<li><a href="#" target="_blank"><i class="fab fa-linkedin"></i></a></li>
							<li><a href="#" target="_blank"><i class="fab fa-dribbble"></i></a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end copyright -->
	
	
	<!-- jquery -->
	<script src="assets/js/jquery-1.11.3.min.js"></script>
	<!-- bootstrap -->
	<script src="assets/bootstrap/js/bootstrap.min.js"></script>
	<!-- count down -->
	<script src="assets/js/jquery.countdown.js"></script>
	<!-- isotope -->
	<script src="assets/js/jquery.isotope-3.0.6.min.js"></script>
	<!-- waypoints -->
	<script src="assets/js/waypoints.js"></script>
	<!-- owl carousel -->
	<script src="assets/js/owl.carousel.min.js"></script>
	<!-- magnific popup -->
	<script src="assets/js/jquery.magnific-popup.min.js"></script>
	<!-- mean menu -->
	<script src="assets/js/jquery.meanmenu.min.js"></script>
	<!-- sticker js -->
	<script src="assets/js/sticker.js"></script>
	<!-- main js -->
	<script src="assets/js/main.js"></script>





<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";
    import { getDatabase, ref, set, push } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-database.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyCDvwIj5sxqJE-yIrkQhBtPLAWDlKxY-zU",
        authDomain: "entiresystem-7ea4f.firebaseapp.com",
        databaseURL: "https://entiresystem-7ea4f-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "entiresystem-7ea4f",
        storageBucket: "entiresystem-7ea4f.appspot.com",
        messagingSenderId: "25619596774",
        appId: "1:25619596774:web:e296b99271610195690227",
        measurementId: "G-LXVGY3MW22"
    };
 // Function to show Bootstrap alert
 function showAlert(message, type) {
        const alertContainer = document.getElementById("alert-container");
        const alert = document.createElement("div");
        alert.className = `alert alert-${type} alert-dismissible fade show`;
        alert.role = "alert";
        alert.innerHTML = `
            ${message}
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        `;
        alertContainer.appendChild(alert);
        
        // Automatically close the alert after 3 seconds
        setTimeout(() => {
            $(alert).alert('close');
        }, 3000);
    }
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);






	document.addEventListener("DOMContentLoaded", function() {
    // Retrieve cart items from local storage
    const cartItemsJSON = localStorage.getItem("cartItems");
    let cartItems = JSON.parse(cartItemsJSON);

    // Get the tbody element of the cart table
    const tbody = document.querySelector(".cart-table tbody");

    // Get the total price cells
    const totalPriceCell = document.querySelector(".total-price");
    const shippingPriceCell = document.getElementById("Shipping");
    const grandTotalCell = document.getElementById("total.");

    // Set shipping price
    const shippingPrice = 30.00;
    shippingPriceCell.innerHTML = `R${shippingPrice.toFixed(2)}`;

    // Function to render cart items
    function renderCartItems() {
        // Clear the tbody
        tbody.innerHTML = "";

        // Initialize total price
        let totalPrice = 0;

        // Check if cartItems is not null and is an array
        if (Array.isArray(cartItems)) {
            // Iterate over the cart items and update the table
            cartItems.forEach((item, index) => {
                if (item && typeof item === 'object') {
                    // Create a new row for the cart item
                    const newRow = document.createElement("tr");
                    newRow.classList.add("table-body-row");

                    // Create table cells for each property of the cart item
                    const removeCell = document.createElement("td");
                    removeCell.classList.add("product-remove");
                    const removeButton = document.createElement("button");
                    removeButton.classList.add("remove-btn");
                    removeButton.innerHTML = '<i class="far fa-window-close"></i>';
                    removeButton.addEventListener('click', function() {
                        removeCartItem(index);
                    });
                    removeCell.appendChild(removeButton);
                    newRow.appendChild(removeCell);

                    const imageCell = document.createElement("td");
                    imageCell.classList.add("product-image");
                    imageCell.innerHTML = `<img src="${item.url}" alt="">`;
                    newRow.appendChild(imageCell);

                    const nameCell = document.createElement("td");
                    nameCell.classList.add("product-name");
                    nameCell.textContent = item.productName;
                    newRow.appendChild(nameCell);

                    const priceCell = document.createElement("td");
                    priceCell.classList.add("product-price");
                    priceCell.textContent = item.productPrice;
                    newRow.appendChild(priceCell);

                    // Add item price to total price
                    totalPrice += parseFloat(item.productPrice);

                    // Append the new row to the tbody
                    tbody.appendChild(newRow);
                } else {
                    console.error("Invalid cart item format:", item);
                }
            });
        } else {
            console.error("Invalid cart items format:", cartItems);
        }

        // Update the total price cell
        totalPriceCell.textContent = `R${totalPrice.toFixed(2)}`;
        grandTotalCell.innerHTML = `R${(shippingPrice + totalPrice).toFixed(2)}`;
    }

    // Function to remove an item from the cart
    function removeCartItem(index) {
        // Remove the item from the cartItems array
        cartItems.splice(index, 1);

        // Update local storage
        localStorage.setItem("cartItems", JSON.stringify(cartItems));

        // Re-render the cart items
        renderCartItems();
    }

    // Function to show Bootstrap alert
    function showAlert(message, type) {
        const alertContainer = document.getElementById("alert-container");
        const alert = document.createElement("div");
        alert.className = `alert alert-${type} alert-dismissible fade show`;
        alert.role = "alert";
        alert.innerHTML = `
            ${message}
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        `;
        alertContainer.appendChild(alert);
        
        // Automatically close the alert after 3 seconds
        setTimeout(() => {
            $(alert).alert('close');
        }, 3000);
    }

    // Initial render of cart items
    renderCartItems();

    // Function to place order
    function placeOrder() {
        // Retrieve cart items and user details from local storage
        const username = localStorage.getItem("username");
        const userEmail = localStorage.getItem("userEmail");
        const shopName = localStorage.getItem("Shopname");

        // Check if cartItems is an array and has items
        if (!Array.isArray(cartItems) || cartItems.length === 0) {
            showAlert('You cannot order nothing, go back and shop <a href="/getstuff/" class="alert-link">HERE!</a>', "warning");
            return;
        }

        // Check if user details are available
        if (username && userEmail) {
            // Create a new order object
            const newOrder = {
                username: username,
                email: userEmail,
                shopName: shopName,
                items: cartItems,
                timestamp: Date.now()
            };

            // Get a reference to the orders collection
            const ordersRef = ref(database, 'orders');

            // Push the new order to the orders collection
            const newOrderRef = push(ordersRef);
            set(newOrderRef, newOrder)
                .then(() => {

                    // Optionally clear the cart and local storage
                    localStorage.removeItem("cartItems");
                    showAlert('Order placed successfully! Track it <a href="/trackit/" class="alert-link">HERE!</a>', "success");
                    // Re-render the cart items
                    renderCartItems();
                })
                .catch((error) => {
                    console.error("Error placing order:", error);
                    showAlert("Error placing order. Please try again.", "danger");
                });
        } else {
            console.error("Invalid order data");
            showAlert("Invalid order data. Please check your information.", "danger");
        }
    }

    // Add event listener to the "Place Order" button
    document.getElementById("place-order").addEventListener("click", placeOrder);
});


















    // // Function to place order
    // function placeOrder() {
    //     // Retrieve cart items and user details from local storage
    //     const username = localStorage.getItem("username");
    //     const userEmail = localStorage.getItem("userEmail");
    //     const shopName = localStorage.getItem("Shopname");
    //     const cartItemsJSON = localStorage.getItem("cartItems");
    //     const cartItems = JSON.parse(cartItemsJSON);

    //     if (username && userEmail && Array.isArray(cartItems)) {
    //         // Create a new order object
    //         const newOrder = {
    //             username: username,
    //             email: userEmail,
    //             shopName: shopName,
    //             items: cartItems,
    //             timestamp: Date.now()
    //         };

    //         // Get a reference to the orders collection
    //         const ordersRef = ref(database, 'orders');

    //         // Push the new order to the orders collection
    //         const newOrderRef = push(ordersRef);
    //         set(newOrderRef, newOrder)
    //             .then(() => {
    //                 console.log("Order placed successfully!");
    //                 // Optionally clear the cart and local storage
    //                 localStorage.removeItem("cartItems");
    //                 showAlert("Order placed successfully!", "success");
    //             })
    //             .catch((error) => {
    //                 console.error("Error placing order:", error);
    //             });
    //     } else {
    //         console.error("Invalid order data");
    //     }
    // }

    // // Add event listener to the "Place Order" button
    // document.getElementById("place-order").addEventListener("click", placeOrder);
</script>

</body>
</html>