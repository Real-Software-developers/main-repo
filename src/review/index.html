<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="description"
      content="website for shopping online on local supermarkets, this is called e-spaza"
    />

    <!-- title -->
    <title>E-Spaza</title>

    <!-- favicon -->
    <link rel="shortcut icon" type="image/png" href="assets/img/favicon.png" />
    <!-- google font -->
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Poppins:400,700&display=swap"
      rel="stylesheet"
    />
    <!-- fontawesome -->
    <link rel="stylesheet" href="assets/css/all.min.css" />
    <!-- bootstrap -->
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css" />
    <!-- owl carousel -->
    <link rel="stylesheet" href="assets/css/owl.carousel.css" />
    <!-- magnific popup -->
    <link rel="stylesheet" href="assets/css/magnific-popup.css" />
    <!-- animate css -->
    <link rel="stylesheet" href="assets/css/animate.css" />
    <!-- mean menu css -->
    <link rel="stylesheet" href="assets/css/meanmenu.min.css" />
    <!-- main style -->
    <link rel="stylesheet" href="assets/css/main.css" />
    <!-- responsive -->
    <link rel="stylesheet" href="assets/css/responsive.css" />
  </head>

  <body>
    <!--PreLoader-->
    <div class="loader">
      <div class="loader-inner">
        <div class="circle"></div>
      </div>
    </div>
    <!--PreLoader Ends-->

    <!-- home page slider -->
    <div class="homepage-slider">
      <!-- single home slider -->
      <div class="single-homepage-slider homepage-bg-1">
        <div class="container">
          <div class="row">
            <div class="col-md-12 col-lg-7 offset-lg-1 offset-xl-0">
              <div class="hero-text">
                <div class="hero-text-tablecell">
                  <p class="subtitle">Admin?</p>
                  <h1>See Shops registers</h1>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- single home slider -->
      <div class="single-homepage-slider homepage-bg-2"></div>
      <!-- single home slider -->
    </div>
    <!-- end home page slider -->

    <!-- features list section -->
    <div class="list-section pt-80 pb-80">
      <div class="container">
        <div class="row">
          <div class="col-lg-4 col-md-6 mb-4 mb-lg-0">
            <div class="list-box d-flex align-items-center">
              <div class="list-icon">
                <i class="fas fa-shipping-fast"></i>
              </div>
              <div class="content">
                <h3>See list of pending and approved stores</h3>
                <p>Manage shops</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- end features list section -->

    <!-- product section -->
    <div class="product-section mt-150 mb-150">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 offset-lg-2 text-center">
            <div class="section-title">
              <h3><span class="orange-text">Approve</span> Local Shops?</h3>
              <p>
                Below is a list of shops that are awaiting approval from you.
              </p>
            </div>
          </div>
        </div>

        <div id="rowdata" class="row"></div>
      </div>
    </div>
    <!-- end product section -->

    <!--APROVED-->
    <!-- product section -->
    <div class="product-section mt-150 mb-150">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 offset-lg-2 text-center">
            <div class="section-title">
              <h3><span class="orange-text">These </span> Are Approved</h3>
              <p>
                The following shops have been approved and they are puplicly
                available to the users on the website
              </p>
            </div>
          </div>
        </div>

        <div id="rowdataapproved" class="row"></div>
      </div>
    </div>
    <!-- end product section -->

    <!-- copyright -->
    <div class="copyright">
      <div class="container">
        <div class="row">
          <div class="col-lg-6 col-md-12">
            <p>Copyrights &copy; e-spaza.com</p>
          </div>
          <div class="col-lg-6 text-right col-md-12">
            <div class="social-icons">
              <ul>
                <li>
                  <a href="#" target="_blank"
                    ><i class="fab fa-facebook-f"></i
                  ></a>
                </li>
                <li>
                  <a href="#" target="_blank"><i class="fab fa-twitter"></i></a>
                </li>
                <li>
                  <a href="#" target="_blank"
                    ><i class="fab fa-instagram"></i
                  ></a>
                </li>
                <li>
                  <a href="#" target="_blank"
                    ><i class="fab fa-linkedin"></i
                  ></a>
                </li>
                <li>
                  <a href="#" target="_blank"
                    ><i class="fab fa-dribbble"></i
                  ></a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- end copyright -->
    <script type="module">
      // Import only the necessary functions from Firebase
      // Import only the necessary functions from Firebase
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-analytics.js";
      import {
        getDatabase,
        ref,
        get,
        push,
        set,
        remove,
      } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-database.js";

      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyCDvwIj5sxqJE-yIrkQhBtPLAWDlKxY-zU",
        authDomain: "entiresystem-7ea4f.firebaseapp.com",
        databaseURL:
          "https://entiresystem-7ea4f-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "entiresystem-7ea4f",
        storageBucket: "entiresystem-7ea4f.appspot.com",
        messagingSenderId: "25619596774",
        appId: "1:25619596774:web:e296b99271610195690227",
        measurementId: "G-LXVGY3MW22",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const database = getDatabase();

      // Function to retrieve and display shop owners data

      // Function to retrieve and display shops data
      function displayShops() {
        const shopsRef = ref(database, "shops");
        get(shopsRef)
          .then((snapshot) => {
            if (snapshot.exists()) {
              console.log("Shops Data:");
              const rowContainer = document.querySelector("#rowdata");
              rowContainer.innerHTML = "";

              snapshot.forEach((childSnapshot) => {
                const shopData = childSnapshot.val();
                console.log(shopData);

                const shopItem = document.createElement("div");
                shopItem.classList.add("col-lg-4", "col-md-6", "text-center");

                const singleProductItem = document.createElement("div");
                singleProductItem.classList.add("single-product-item");

                const productImage = document.createElement("div");
                productImage.classList.add("product-image");
                productImage.innerHTML =
                  '<a href="#"><img src="/shop.jpeg" alt=""></a>';

                const shopDescription = document.createElement("h3");
                shopDescription.textContent = shopData.description;

                const productPrice = document.createElement("p");
                productPrice.classList.add("product-price");
                productPrice.innerHTML = `<span>${shopData.location}</span> ${shopData.shopName}`;

                const cartBtn = document.createElement("a");
                cartBtn.classList.add("cart-btn");
                cartBtn.innerHTML =
                  '<i class="fas fa-shopping-cart"></i> Approve.';

                //disaprove button.

                const disapprove = document.createElement("a");
                disapprove.classList.add("cart-btn");
                disapprove.innerHTML =
                  '<i class="fas fa-shopping-cart"></i> deny.';
                disapprove.href = "#";

                singleProductItem.appendChild(productImage);
                singleProductItem.appendChild(shopDescription);
                singleProductItem.appendChild(productPrice);
                singleProductItem.appendChild(cartBtn);
                singleProductItem.appendChild(disapprove);
                shopItem.appendChild(singleProductItem);
                rowContainer.appendChild(shopItem);

                disapprove.addEventListener("click", function () {
                  const shopToRemoveRef = ref(
                    database,
                    `shops/${childSnapshot.key}`
                  );

                  // Remove the shop from the "shops" collection
                  remove(shopToRemoveRef)
                    .then(() => {
                      console.log(
                        "Shop removed from shops collection after disapproval"
                      );
                    })
                    .catch((error) => {
                      console.error(
                        "Error removing shop from shops collection:",
                        error
                      );
                    });
                });

                cartBtn.addEventListener("click", function () {
                  const approvedShopsRef = ref(database, "Approved_Shops");
                  const newShopRef = push(approvedShopsRef);
                  set(newShopRef, {
                    description: shopData.description,
                    location: shopData.location,
                    shopName: shopData.shopName,
                    //send email.
                  })
                    .then(() => {
                      console.log(
                        "Shop approved and added to Approved_Shops collection"
                      );

                      // Get the key of the newly added shop
                      const newShopKey = newShopRef.key;

                      console.log(newShopKey);

                      // Get a reference to the specific shop in the "shops" collection
                      const shopToRemoveRef = ref(
                        database,
                        `shops/${childSnapshot.key}`
                      );

                      console.log(shopToRemoveRef);
                      // Remove the shop from the "shops" collection
                      remove(shopToRemoveRef)
                        .then(() => {
                          console.log(
                            "Shop removed from shops collection after approval"
                          );
                        })
                        .catch((error) => {
                          console.error(
                            "Error removing shop from shops collection:",
                            error
                          );
                        });
                    })
                    .catch((error) => {
                      console.error("Error approving shop:", error);
                    });
                });
              });
            } else {
              console.log("No shops found.");
            }
          })
          .catch((error) => {
            console.error("Error retrieving shops data:", error);
          });
      }
      function displayShopsApproved() {
        const shopsRef = ref(database, "Approved_Shops");
        get(shopsRef)
          .then((snapshot) => {
            if (snapshot.exists()) {
              console.log("Shops Data:");
              // Get the container element for shops
              const rowContainer = document.querySelector("#rowdataapproved");
              // Clear previous content
              rowContainer.innerHTML = "";

              snapshot.forEach((childSnapshot) => {
                const shopData = childSnapshot.val();
                console.log(shopData);

                // Create elements for a single shop
                const shopItem = document.createElement("div");
                shopItem.classList.add("col-lg-4", "col-md-6", "text-center");

                const singleProductItem = document.createElement("div");
                singleProductItem.classList.add("single-product-item");

                const productImage = document.createElement("div");
                productImage.classList.add("product-image");
                productImage.innerHTML =
                  '<a href="#"><img src="/shop.jpeg" alt=""></a>';

                const shopDescription = document.createElement("h3");
                shopDescription.textContent = shopData.description;

                const productPrice = document.createElement("p");
                productPrice.classList.add("product-price");
                productPrice.innerHTML = `<span>${shopData.location}</span> ${shopData.shopName}`;

                const cartBtn = document.createElement("a");
                cartBtn.classList.add("cart-btn");
                cartBtn.href = "#";
                cartBtn.innerHTML =
                  '<i class="fas fa-shopping-cart"></i> Visit Shop.';

                const disapprove = document.createElement("a");
                disapprove.classList.add("cart-btn");
                disapprove.innerHTML =
                  '<i class="fas fa-shopping-cart"></i> Delete.';
                disapprove.href = "#";
                singleProductItem.appendChild(productImage);
                singleProductItem.appendChild(shopDescription);
                singleProductItem.appendChild(productPrice);
                singleProductItem.appendChild(cartBtn);
                singleProductItem.appendChild(disapprove);
                // Append single product item to row container
                shopItem.appendChild(singleProductItem);
                rowContainer.appendChild(shopItem);

                disapprove.addEventListener("click", function () {
                  const shopToRemoveRef = ref(
                    database,
                    `Approved_Shops/${childSnapshot.key}`
                  );

                  // Remove the shop from the "shops" collection
                  remove(shopToRemoveRef)
                    .then(() => {
                      console.log(
                        "Shop removed from shops collection after disapproval"
                      );
                    })
                    .catch((error) => {
                      console.error(
                        "Error removing shop from shops collection:",
                        error
                      );
                    });
                });

                // Append elements to single product item
              });
            } else {
              console.log("No shops found.");
            }
          })
          .catch((error) => {
            console.error("Error retrieving shops data:", error);
          });
      }

      // Call functions to display shop owners and shops data

      displayShops();

      // Call functions to display shop owners and shops data
      displayShopsApproved();
    </script>

    <!-- jquery -->
    <script src="assets/js/jquery-1.11.3.min.js"></script>
    <!-- bootstrap -->
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <!-- count down -->
    <script src="assets/js/jquery.countdown.js"></script>
    <!-- isotope -->
    <script src="assets/js/jquery.isotope-3.0.6.min.js"></script>
    <!-- waypoints -->
    <script src="assets/js/waypoints.js"></script>
    <!-- owl carousel -->
    <script src="assets/js/owl.carousel.min.js"></script>
    <!-- magnific popup -->
    <script src="assets/js/jquery.magnific-popup.min.js"></script>
    <!-- mean menu -->
    <script src="assets/js/jquery.meanmenu.min.js"></script>
    <!-- sticker js -->
    <script src="assets/js/sticker.js"></script>
    <!-- main js -->
    <script src="assets/js/main.js"></script>
  </body>
</html>
